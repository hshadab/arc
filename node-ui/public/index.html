<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Circle OOAK + zkML - Cryptographic Agent Approvals</title>
    <style>
      :root {
        --bg: #0a0e1a;
        --fg: #e7ecf7;
        --muted: #8b92a8;
        --primary: #5b8cff;
        --accent: #4de2cf;
        --success: #10b981;
        --card: #0f1420;
        --border: #1a1f2e;
        --step-bg: #141825;
      }
      * { box-sizing: border-box; margin: 0; padding: 0; }
      html, body { background: var(--bg); color: var(--fg); font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 16px; }

      /* Hero */
      .hero {
        background: linear-gradient(135deg, #1a1f2e 0%, #0a0e1a 100%);
        padding: 30px 20px 20px;
        text-align: center;
        border-bottom: 1px solid var(--border);
        position: relative;
      }
      .cost-tracker {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(77, 226, 207, 0.1);
        border: 1px solid var(--accent);
        border-radius: 8px;
        padding: 10px 16px;
        font-size: 14px;
        font-weight: 600;
        color: var(--accent);
        display: none;
      }
      .cost-tracker.visible {
        display: block;
      }
      .cost-amount {
        font-size: 18px;
        margin-left: 6px;
      }
      .hero-logos {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 30px;
        margin-bottom: 20px;
      }
      .hero-logos img {
        height: 40px;
        object-fit: contain;
      }
      .hero-logos img:first-child {
        height: 48px;
      }
      .hero h1 {
        font-size: 42px;
        font-weight: 700;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 8px;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }
      .hero p {
        color: var(--muted);
        font-size: 22px;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      /* Container */
      .container { max-width: 1600px; margin: 0 auto; padding: 40px 20px; }

      /* Flow Diagram */
      .flow-diagram {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 40px 20px;
        margin-bottom: 40px;
        overflow-x: auto;
        position: relative;
      }
      .flow-diagram-run-btn {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-655px);
        z-index: 10;
        padding: 14px 28px;
        background: rgba(91, 140, 255, 0.5);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(91, 140, 255, 0.3);
        opacity: 1;
        transition: background 0.2s ease;
      }
      .flow-diagram-run-btn:hover {
        background: rgba(91, 140, 255, 0.6);
      }
      .flow-diagram-run-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .flow-main {
        display: flex;
        align-items: stretch;
        justify-content: center;
        min-width: 1450px;
        gap: 12px;
      }
      .arrow-column {
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 20px;
        flex: 0 0 30px;
      }

      /* Flow Box - Standard */
      .flow-box {
        flex: 0 0 175px;
        background: var(--step-bg);
        border: 2px solid rgba(139, 146, 168, 0.4);
        border-radius: 12px;
        padding: 16px;
        text-align: center;
        position: relative;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-self: center;
      }
      .flow-box.active {
        border-color: var(--primary);
        box-shadow: 0 0 20px rgba(91, 140, 255, 0.3);
        animation: boxGlow 1.5s ease-in-out infinite;
      }
      @keyframes boxGlow {
        0%, 100% {
          box-shadow: 0 0 20px rgba(91, 140, 255, 0.3);
          border-color: var(--primary);
        }
        50% {
          box-shadow: 0 0 30px rgba(91, 140, 255, 0.6);
          border-color: var(--accent);
        }
      }
      .flow-box.success {
        border-color: var(--success);
        background: rgba(16, 185, 129, 0.05);
      }

      /* Secure Tool Box - Special Large Box */
      .flow-box-secure {
        flex: 0 0 420px;
        background: var(--step-bg);
        border: 2px solid var(--accent);
        border-radius: 12px;
        padding: 20px;
        position: relative;
        transition: all 0.3s ease;
      }
      .flow-box-secure.active {
        box-shadow: 0 0 25px rgba(77, 226, 207, 0.3);
        animation: borderPulse 1.5s ease-in-out infinite;
      }
      @keyframes borderPulse {
        0%, 100% {
          border-color: var(--accent);
          box-shadow: 0 0 25px rgba(77, 226, 207, 0.3);
        }
        50% {
          border-color: var(--primary);
          box-shadow: 0 0 35px rgba(91, 140, 255, 0.5);
        }
      }
      .flow-box-secure.success {
        background: rgba(77, 226, 207, 0.05);
      }
      .secure-tool-header {
        font-size: 28px;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 2px solid var(--accent);
        text-align: center;
      }
      .secure-tool-items {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .secure-tool-item {
        background: rgba(77, 226, 207, 0.08);
        border: 1px solid rgba(77, 226, 207, 0.2);
        border-radius: 8px;
        padding: 12px;
        text-align: left;
        transition: all 0.3s ease;
      }
      .secure-tool-item.active {
        border-color: var(--accent);
        background: rgba(77, 226, 207, 0.15);
        animation: itemGlow 1.5s ease-in-out infinite;
      }
      @keyframes itemGlow {
        0%, 100% {
          box-shadow: 0 0 15px rgba(77, 226, 207, 0.3);
          border-color: var(--accent);
        }
        50% {
          box-shadow: 0 0 25px rgba(77, 226, 207, 0.6);
          border-color: var(--primary);
        }
      }
      /* Purple NovaNet proof step - matches step 3/3 */
      #secure-item-1b.active {
        animation: itemGlow 1.5s ease-in-out infinite;
      }
      #secure-item-1b.success {
        border-color: #a78bfa;
        background: rgba(167, 139, 250, 0.1);
      }
      .secure-tool-item.success {
        border-color: var(--success);
        background: rgba(16, 185, 129, 0.1);
      }
      .secure-tool-item.purple {
        border-color: #a78bfa;
        background: rgba(167, 139, 250, 0.1);
      }
      .secure-tool-item.success.purple {
        border-color: #a78bfa;
        background: rgba(167, 139, 250, 0.1);
      }
      .secure-tool-item-number {
        font-size: 15px;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 4px;
      }
      .secure-tool-item-title {
        font-size: 17px;
        font-weight: 600;
        color: var(--fg);
        margin-bottom: 2px;
      }
      .secure-tool-item-desc {
        font-size: 14px;
        color: var(--muted);
        line-height: 1.4;
      }

      /* Icons */
      .flow-box-icon {
        width: 55px;
        height: 55px;
        margin: 0 auto 10px;
        background: rgba(91, 140, 255, 0.1);
        border: 2px solid rgba(139, 146, 168, 0.3);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }
      .flow-box-icon svg {
        width: 28px;
        height: 28px;
        stroke: rgba(91, 140, 255, 0.7);
        stroke-width: 2;
      }
      .flow-box.success .flow-box-icon {
        background: rgba(16, 185, 129, 0.1);
        border-color: rgba(16, 185, 129, 0.4);
      }
      .flow-box.success .flow-box-icon svg {
        stroke: var(--success);
      }
      .flow-box.active .flow-box-icon {
        border-color: var(--primary);
        background: rgba(91, 140, 255, 0.15);
      }
      .flow-box.active .flow-box-icon svg {
        stroke: var(--primary);
      }
      .flow-box-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 6px;
        color: var(--fg);
      }
      .flow-box-desc {
        font-size: 17px;
        color: var(--muted);
        line-height: 1.4;
      }

      /* Circle Badge */
      .circle-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        background: rgba(77, 226, 207, 0.15);
        border: 1px solid rgba(77, 226, 207, 0.3);
        border-radius: 8px;
        font-size: 11px;
        font-weight: 600;
        color: var(--accent);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-top: 6px;
        transition: all 0.2s ease;
      }
      .circle-badge:hover {
        background: rgba(77, 226, 207, 0.25);
        border-color: var(--accent);
        transform: translateY(-1px);
      }
      .circle-badge::before {
        content: "●";
        color: var(--accent);
        font-size: 5px;
      }

      /* Arrows */
      .flow-arrow {
        flex: 0 0 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 107px;
        font-weight: bold;
        color: var(--border);
        transition: all 0.3s ease;
      }
      .flow-arrow.active {
        color: var(--primary);
        font-weight: bold;
      }

      /* Interactive Section */
      .interactive-section {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
      }
      .section-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .section-icon {
        width: 32px;
        height: 32px;
        background: rgba(91, 140, 255, 0.15);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      }

      /* Form */
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }
      .form-group label {
        display: block;
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 8px;
        color: var(--muted);
      }
      .form-group input {
        width: 100%;
        padding: 14px 18px;
        background: var(--step-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--fg);
        font-size: 16px;
        transition: all 0.2s;
      }
      .form-group input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(91, 140, 255, 0.1);
      }

      /* Buttons */
      .btn {
        padding: 14px 28px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      .btn-primary {
        background: linear-gradient(135deg, var(--primary), #4d7ff7);
        color: white;
      }
      .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(91, 140, 255, 0.4); }
      .btn-secondary {
        background: var(--step-bg);
        color: var(--muted);
        border: 1px solid var(--border);
      }
      .btn-secondary:disabled { opacity: 0.5; cursor: not-allowed; }

      /* Results */
      .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }
      .result-card {
        background: var(--step-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
      }
      .result-card.hidden { display: none; }
      .result-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border);
      }
      .result-badge {
        padding: 5px 12px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
      }
      .result-badge.success {
        background: rgba(16, 185, 129, 0.15);
        color: var(--success);
      }
      .result-card pre {
        font-size: 14px;
        color: var(--muted);
        white-space: pre-wrap;
        word-wrap: break-word;
        line-height: 1.6;
      }

      /* Key-Value Card Styles */
      .kv-card {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .kv-row {
        display: grid;
        grid-template-columns: 140px 20px 1fr;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid rgba(77, 226, 207, 0.1);
        transition: background 0.2s ease;
      }
      .kv-row:hover {
        background: rgba(77, 226, 207, 0.05);
        border-radius: 6px;
      }
      .kv-row:last-child {
        border-bottom: none;
      }
      .kv-key {
        font-size: 13px;
        font-weight: 600;
        color: var(--accent);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .kv-arrow {
        color: var(--accent);
        font-size: 12px;
        opacity: 0.6;
      }
      .kv-value {
        font-size: 15px;
        font-family: 'Monaco', 'Menlo', monospace;
      }
      .kv-string {
        color: var(--fg);
      }
      .kv-number {
        color: #64b5f6;
        font-weight: 600;
      }
      .kv-bool {
        color: #81c784;
        font-weight: 600;
      }
      .kv-null {
        color: var(--muted);
        font-style: italic;
      }
      .kv-address {
        color: #ffa726;
        background: rgba(255, 167, 38, 0.1);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 13px;
      }
      .kv-hash {
        color: #ab47bc;
        background: rgba(171, 71, 188, 0.1);
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 13px;
      }
      .kv-date {
        color: #4db8e8;
        font-size: 14px;
      }

      /* Phase Labels */
      .phase-label {
        text-align: center;
        padding: 12px;
        margin: 10px 0;
        background: linear-gradient(135deg, rgba(91, 140, 255, 0.15), rgba(77, 226, 207, 0.15));
        border: 2px solid transparent;
        border-radius: 8px;
        position: relative;
        overflow: hidden;
      }
      .phase-label.active {
        animation: phaseGlow 1.5s ease-in-out infinite;
      }
      @keyframes phaseGlow {
        0%, 100% {
          border-color: var(--primary);
          box-shadow: 0 0 20px rgba(91, 140, 255, 0.4);
        }
        50% {
          border-color: var(--accent);
          box-shadow: 0 0 30px rgba(77, 226, 207, 0.6);
        }
      }
      .phase-text {
        font-size: 14px;
        font-weight: 700;
        color: var(--accent);
        letter-spacing: 1px;
        text-transform: uppercase;
      }

      /* Info Section */
      .info-section {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 30px;
      }
      .info-section h3 {
        font-size: 22px;
        margin-bottom: 16px;
        color: var(--fg);
      }
      .info-section ul {
        list-style: none;
        padding: 0;
      }
      .info-section li {
        padding: 12px 0;
        border-bottom: 1px solid var(--border);
        font-size: 16px;
        color: var(--muted);
        line-height: 1.5;
      }
      .info-section li:last-child { border-bottom: none; }
      .info-section b { color: var(--fg); font-weight: 600; }

      @media (max-width: 768px) {
        .hero h1 { font-size: 22px; }
        .flow-diagram { padding: 20px 10px; }
        .flow-main { min-width: 1100px; }
      }
    </style>
  </head>
  <body>
    <!-- Hero -->
    <div class="hero">
      <div class="hero-logos">
        <img src="https://cdn.prod.website-files.com/685311a976e7c248b5dfde95/688f6e47eca8d8e359537b5f_logo-ondark.svg" alt="Circle Logo">
        <img src="https://cdn.prod.website-files.com/65d52b07d5bc41614daa723f/665df12739c532f45b665fe7_logo-novanet.svg" alt="NovaNet Logo">
      </div>
      <h1>Trustless USDC Agents</h1>
      <p>Circle's Object Oriented Agent Kit with NovaNet zkML on Arc</p>
    </div>

    <!-- Main Container -->
    <div class="container">

      <!-- Flow Diagram -->
      <div class="flow-diagram">
        <button type="button" class="flow-diagram-run-btn" id="flow-run-btn">▶ Initiate User Request</button>
        <div class="flow-main">

          <!-- 1. User Request -->
          <div class="flow-box" id="flow-1">
            <div class="flow-box-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="5"/><path d="M20 21a8 8 0 1 0-16 0"/></svg>
            </div>
            <div class="flow-box-title">User Request</div>
            <div class="flow-box-desc">Initiates transaction</div>
          </div>
          <div class="flow-arrow" id="arrow-1">→</div>

          <!-- 2. WalletInstanceAgent -->
          <div class="flow-box" id="flow-2">
            <div class="flow-box-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/></svg>
            </div>
            <div class="flow-box-title">WalletInstanceAgent</div>
            <div class="flow-box-desc" id="agent-desc">Pay via x402</div>
            <div class="flow-box-desc" style="font-size: 12px; margin-top: 4px; color: #ffa726;">Wallet: 0x1f40...0CC6</div>
            <a href="https://www.circle.com/blog/ooak-object-oriented-agent-kit" target="_blank" style="text-decoration: none;">
              <div class="circle-badge" style="cursor: pointer;">Circle OOAK</div>
            </a>
            <div id="agent-payment-link" style="margin-top: 8px; display: none; font-size: 14px;"></div>
          </div>
          <div class="flow-arrow" id="arrow-2">→</div>

          <!-- 3. @secure_tool (Circle hooks + zkML components) -->
          <div class="flow-box-secure" id="flow-4">
            <div class="secure-tool-header">@secure_tool: send_usdc</div>
            <div class="secure-tool-items">
              <div class="secure-tool-item" id="secure-item-1">
                <div class="secure-tool-item-number">Approval Hook 1/3</div>
                <div class="secure-tool-item-title">Run Spending Authorization Model</div>
                <div class="secure-tool-item-desc">ONNX model decides if transaction is authorized</div>
              </div>
              <div class="secure-tool-item purple" id="secure-item-1b">
                <div class="secure-tool-item-number">Approval Hook 2/3</div>
                <div class="secure-tool-item-title">NovaNet Spending Proof Generation</div>
                <div class="secure-tool-item-desc" id="zkml-proof-desc"><a href="https://github.com/ICME-Lab/jolt-atlas" target="_blank" style="color: var(--accent); text-decoration: underline; font-weight: 600;">JOLT-Atlas zkML</a> inference proof (x402 service)</div>
              </div>
              <div class="secure-tool-item purple" id="secure-item-2">
                <div class="secure-tool-item-number">Approval Hook 3/3</div>
                <div class="secure-tool-item-title">Proof Attestation on Arc</div>
                <div class="secure-tool-item-desc" id="zkml-verify-desc">Commitment attested and registered <span id="arc-blockchain-link">on Arc blockchain</span></div>
              </div>
              <div class="secure-tool-item" id="secure-item-3">
                <div class="secure-tool-item-number">Tool Execution</div>
                <div class="secure-tool-item-title">send_usdc(wfid=approved)</div>
                <div class="secure-tool-item-desc" id="send-usdc-desc">Transfer USDC on Arc Testnet if all checks pass</div>
              </div>
              <div class="secure-tool-item" id="secure-item-4">
                <div class="secure-tool-item-number">Post-Execution Hook</div>
                <div class="secure-tool-item-title">Transaction Validation</div>
              </div>
            </div>
          </div>
          <div class="flow-arrow" id="arrow-4">↔</div>

          <!-- 4. Workflow Manager -->
          <div class="flow-box" id="flow-5">
            <div class="flow-box-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="8" y="8" width="8" height="8" rx="2"/><path d="M4 10a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2"/><path d="M14 20a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2"/></svg>
            </div>
            <div class="flow-box-title">Workflow Manager</div>
            <div class="flow-box-desc" id="flow-5-desc">Evaluating...</div>
          </div>

        </div>
      </div>

      <!-- Interactive Section: Input -->
      <div class="interactive-section">
        <div class="section-title">
          <div class="section-icon" style="background: rgba(91, 140, 255, 0.1); border: 2px solid rgba(139, 146, 168, 0.3); display: flex; align-items: center; justify-content: center;">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(91, 140, 255, 0.7)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
          </div>
          <span>Configure Transaction</span>
        </div>
        <form id="request-form">
          <div class="form-grid">
            <div class="form-group">
              <label>Amount (USD)</label>
              <input type="number" id="amount" step="0.01" value="25.0" placeholder="0.00" />
            </div>
            <div class="form-group">
              <label>Risk Score (0-1)</label>
              <input type="number" id="risk" step="0.01" min="0" max="1" value="0.01" placeholder="0.00" />
            </div>
          </div>
          <button type="submit" class="btn btn-primary">▶ Run Cryptographic Approval Workflow</button>
        </form>
      </div>

      <!-- Results Section -->
      <div class="interactive-section">
        <div class="section-title">
          <div class="section-icon" style="background: rgba(91, 140, 255, 0.1); border: 2px solid rgba(139, 146, 168, 0.3); display: flex; align-items: center; justify-content: center;">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(91, 140, 255, 0.7)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
          </div>
          <span>Workflow Results</span>
        </div>
        <div class="results-grid">
          <!-- Result: ONNX -->
          <div class="result-card hidden" id="result-onnx">
            <div class="result-header">
              <span style="font-weight:600; font-size:16px;">ONNX Neural Network</span>
              <span class="result-badge success">SUCCESS</span>
            </div>
            <pre id="result-onnx-content"></pre>
          </div>

          <!-- Result: JOLT -->
          <div class="result-card hidden" id="result-jolt">
            <div class="result-header">
              <span style="font-weight:600; font-size:16px;">JOLT zkML Proof</span>
              <span class="result-badge success">SUCCESS</span>
            </div>
            <pre id="result-jolt-content"></pre>
          </div>

          <!-- Result: On-Chain Verification -->
          <div class="result-card" id="result-groth16">
            <div class="result-header">
              <span style="font-weight:600; font-size:16px;">On-Chain Attested Commitment</span>
              <span class="result-badge success">SUCCESS</span>
            </div>
            <pre id="result-groth16-content"></pre>
          </div>

          <!-- Result: Commitment Details -->
          <div class="result-card hidden" id="result-commit">
            <div class="result-header">
              <span style="font-weight:600; font-size:16px;">Commitment Details</span>
              <span class="result-badge success">SUCCESS</span>
            </div>
            <pre id="result-commit-content"></pre>
          </div>

          <!-- Result: Workflow Manager -->
          <div class="result-card hidden" id="result-manager">
            <div class="result-header">
              <span style="font-weight:600; font-size:16px;">Workflow Manager Decision</span>
              <span class="result-badge success">SUCCESS</span>
            </div>
            <pre id="result-manager-content"></pre>
          </div>
        </div>
      </div>

      <!-- Payment Section -->
      <div class="interactive-section">
        <div class="section-title">
          <div class="section-icon" style="background: rgba(91, 140, 255, 0.1); border: 2px solid rgba(139, 146, 168, 0.3); display: flex; align-items: center; justify-content: center;">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="rgba(91, 140, 255, 0.7)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
          </div>
          <span>Commit + Spend (Arc)</span>
        </div>
        <form id="payment-form">
          <div class="form-grid">
            <div class="form-group">
              <label>Recipient Address</label>
              <input type="text" id="to" value="0x2e408ad62e30146404F4ED8A61253212f3f9A490" />
            </div>
            <div class="form-group">
              <label>Amount (USDC)</label>
              <input type="number" id="send-amount" step="0.01" value="0.01" />
            </div>
          </div>
          <button type="submit" class="btn btn-secondary" id="send-btn" disabled>Commit + Spend</button>
        </form>
        <div class="result-card hidden" id="result-payment" style="margin-top: 20px;">
          <div class="result-header">
            <span style="font-weight:600; font-size:16px;">Payment Transaction</span>
            <span class="result-badge success">SUCCESS</span>
          </div>
          <pre id="result-payment-content"></pre>
        </div>
      </div>

      <!-- OOAK Context Section -->
      <div class="info-section">
        <h3>Circle OOAK: Object-Oriented Agent Kit</h3>
        <ul>
          <li><b>WalletInstanceAgent:</b> An agent with encapsulated wallet state (0x1f40...0CC6) — not a global wallet accessible by all agents. Each agent instance maintains its own secure credentials.</li>
          <li><b>@secure_tool Decorator:</b> Adds approval hooks before tool execution. Tools protected with @secure_tool run a 3-step workflow:
            <ul style="margin-top: 8px; margin-left: 20px;">
              <li><b>1. Intent Creation:</b> Agent calls send_usdc(wfid=None) → Returns JSON intent (not executed yet)</li>
              <li><b>2. Approval Phase:</b> Three hooks run in before_invoke_tool() to validate the request</li>
              <li><b>3. Execution Phase:</b> With approved WorkflowId, send_usdc(wfid=approved) executes</li>
            </ul>
          </li>
          <li><b>WorkflowManager:</b> Evaluates all approval hook results and makes the final go/no-go authorization decision</li>
          <li><b>Learn More:</b>
            <a href="https://www.circle.com/blog/ooak-object-oriented-agent-kit" target="_blank" style="color: var(--accent); text-decoration: underline; font-weight: 600;">Circle OOAK Blog</a> |
            <a href="https://github.com/circlefin/circle-ooak" target="_blank" style="color: var(--accent); text-decoration: underline; font-weight: 600;">GitHub: circlefin/circle-ooak</a>
          </li>
        </ul>
        <h3 style="margin-top: 30px;">This Demo Adds:</h3>
        <ul>
          <li><b>zkML Proofs via NovaNet:</b> Uses <a href="https://github.com/ICME-Lab/jolt-atlas" target="_blank" style="color: var(--accent); text-decoration: underline;">JOLT-Atlas</a> to generate cryptographic proofs of ONNX inference (~600-800ms). The ML model is a 67KB medium text classification network for spending authorization in agentic commerce scenarios.</li>
          <li><b>x402 Micropayments:</b> Implements <a href="https://github.com/coinbase/x402" target="_blank" style="color: var(--accent); text-decoration: underline;">Coinbase x402 protocol</a> for HTTP 402 Payment Required on Arc testnet</li>
          <li><b>Arc Blockchain Integration:</b> Commitment attestation and USDC payments on Circle's Arc L1 with USDC as native gas</li>
        </ul>
      </div>

    </div>

    <script>
      const $ = s => document.querySelector(s);

      function updateFlowBox(num, state) {
        const box = $(`#flow-${num}`);
        if (!box) return;
        box.classList.remove('active', 'success');
        if (state === 'active') box.classList.add('active');
        if (state === 'success') box.classList.add('success');
      }

      function updateSecureItem(num, state) {
        const item = $(`#secure-item-${num}`);
        if (!item) return;
        item.classList.remove('active', 'success');
        if (state === 'active') item.classList.add('active');
        if (state === 'success') item.classList.add('success');
      }

      function updateArrow(num, active) {
        const arrow = $(`#arrow-${num}`);
        if (!arrow) return;
        if (active) arrow.classList.add('active');
        else arrow.classList.remove('active');
      }

      // Format value based on type
      function formatValue(key, value) {
        if (value === null || value === undefined) return '<span class="kv-null">null</span>';
        if (typeof value === 'boolean') return value ? '<span class="kv-bool">true</span>' : '<span class="kv-bool">false</span>';

        // Format addresses
        if (typeof value === 'string' && value.startsWith('0x') && value.length === 42) {
          return `<span class="kv-address">${value.substring(0, 6)}...${value.substring(38)}</span>`;
        }

        // Format hashes
        if (typeof value === 'string' && value.startsWith('0x') && value.length === 66) {
          return `<span class="kv-hash">${value.substring(0, 10)}...${value.substring(58)}</span>`;
        }

        // Format timestamps
        if (key.toLowerCase().includes('timestamp') && typeof value === 'number') {
          const date = new Date(value * 1000);
          return `<span class="kv-date">${date.toLocaleString()}</span>`;
        }

        // Format block numbers
        if (key.toLowerCase().includes('block') && typeof value === 'number') {
          return `<span class="kv-number">#${value.toLocaleString()}</span>`;
        }

        // Format regular numbers
        if (typeof value === 'number') {
          return `<span class="kv-number">${value.toLocaleString()}</span>`;
        }

        return `<span class="kv-string">${value}</span>`;
      }

      // Convert JSON to key-value card HTML
      function jsonToCard(data) {
        let html = '<div class="kv-card">';
        for (const [key, value] of Object.entries(data)) {
          const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
          html += `
            <div class="kv-row">
              <div class="kv-key">${label}</div>
              <div class="kv-arrow">►</div>
              <div class="kv-value">${formatValue(key, value)}</div>
            </div>
          `;
        }
        html += '</div>';
        return html;
      }

      function showResult(id, data) {
        const resultEl = $(`#result-${id}`);
        const contentEl = $(`#result-${id}-content`);
        if (!resultEl || !contentEl) return;
        resultEl.classList.remove('hidden');
        contentEl.innerHTML = jsonToCard(data);
      }

      let approvalData = null;

      // Connect flow diagram run button to form submission
      $('#flow-run-btn').addEventListener('click', () => {
        const submitEvent = new Event('submit', { cancelable: true });
        $('#request-form').dispatchEvent(submitEvent);
      });

      $('#request-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        // Disable run button during workflow
        $('#flow-run-btn').disabled = true;
        $('#flow-run-btn').textContent = 'Running...';

        // Reset
        for (let i = 1; i <= 5; i++) updateFlowBox(i, '');
        for (let i = 1; i <= 4; i++) updateSecureItem(i, '');
        updateSecureItem('1b', ''); // Reset zkML proof step
        for (let i = 1; i <= 4; i++) updateArrow(i, false);
        ['onnx', 'jolt', 'groth16', 'manager', 'payment'].forEach(id => {
          $(`#result-${id}`)?.classList.add('hidden');
        });
        $('#send-btn').disabled = true;
        approvalData = null;

        const amount = parseFloat($('#amount').value);
        const risk = parseFloat($('#risk').value);

        try {
          // Step 1: User Request
          updateFlowBox(1, 'success');
          updateArrow(1, true);
          await new Promise(r => setTimeout(r, 200));

          // Step 2: AI Agent
          updateFlowBox(2, 'active');
          await new Promise(r => setTimeout(r, 300));
          updateFlowBox(2, 'success');
          updateArrow(2, true);
          await new Promise(r => setTimeout(r, 200));

          // Step 3: Activate @secure_tool box before approval workflow starts
          updateFlowBox(4, 'active');
          updateArrow(4, true);
          await new Promise(r => setTimeout(r, 400));

          // Step 4: @secure_tool - Item 1 (Authorization Check)
          updateSecureItem(1, 'active');
          await new Promise(r => setTimeout(r, 300));

          // Reset cost tracker
          if (window.x402UI) window.x402UI.resetCost();

          const resp = await fetch('http://localhost:8616/api/approve', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ amount, risk })
          });

          const data = await resp.json();
          approvalData = data;

          if (data.error) throw new Error(data.error);

          showResult('onnx', {
            decision: data.decision === 1 ? 'APPROVED' : 'DENIED',
            confidence: `${data.confidence}%`,
            model: 'spending_model.onnx (rule-net: thresholds + weights)'
          });

          // Show x402 payment if present
          if (data.x402Payment && window.x402UI) {
            console.log('[x402] Payment detected:', data.x402Payment);
            window.x402UI.updateCost(data.x402Payment.cost.replace('$', '').replace(' USDC', ''));
            window.x402UI.showPaymentStatus('paid', data.x402Payment);
          }

          // Show commitment attestation link if present
          if (data.commit && data.commit.explorerLink) {
            console.log('[Commitment] Attestation link:', data.commit.explorerLink);
            const arcBlockchainLink = $('#arc-blockchain-link');
            if (arcBlockchainLink) {
              arcBlockchainLink.innerHTML = `<a href="${data.commit.explorerLink}" target="_blank" style="color: var(--accent); text-decoration: underline; font-weight: 600;">on Arc blockchain</a>`;
              console.log('[Commitment] Made "on Arc blockchain" a hyperlink');
            }
          }

          // Item 1 complete
          updateSecureItem(1, 'success');
          await new Promise(r => setTimeout(r, 300));

          // Step 4b: @secure_tool - Item 1b (zkML Proof Generation)
          updateSecureItem('1b', 'active');
          await new Promise(r => setTimeout(r, 3000)); // Longer wait for proof generation
          updateSecureItem('1b', 'success');
          await new Promise(r => setTimeout(r, 300));

          // Step 5: @secure_tool - Item 2 (Attested Commitment on Arc)
          updateSecureItem(2, 'active');
          await new Promise(r => setTimeout(r, 400));
          updateSecureItem(2, 'success');

          updateFlowBox(4, 'success');
          showResult('groth16', {
            attestation: 'EIP-712 signature verified on-chain',
            registry: 'CommitmentRegistry (Arc testnet)',
            note: 'Attested commitment will be created on spend'
          });
          await new Promise(r => setTimeout(r, 300));

          // Step 4: Workflow Manager
          updateFlowBox(5, 'active');

          await new Promise(r => setTimeout(r, 400));

          // Update Workflow Manager description
          const flow5Desc = $('#flow-5-desc');
          if (flow5Desc) {
            flow5Desc.textContent = data.decision === 1 ? '✓ Approved' : '✗ Denied';
          }

          updateFlowBox(5, 'success');

          showResult('manager', {
            decision: data.decision === 1 ? '✓ APPROVED' : '✗ DENIED',
            readyForPayment: data.decision === 1
          });

          // Auto-execute commit+spend if approved
          if (data.decision === 1) {
            await new Promise(r => setTimeout(r, 500));

            // Step 3: send_usdc execution
            updateSecureItem(3, 'active');
            await new Promise(r => setTimeout(r, 300));

            const resp = await fetch('http://localhost:8616/api/send-usdc', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                to: $('#to').value,
                amount: $('#send-amount').value
              })
            });

            const usdcData = await resp.json();
            if (usdcData.error) throw new Error(usdcData.error);

            // Update USDC transaction description with hyperlinked amount and on-chain timing
            console.log('[USDC] Response data:', usdcData);
            console.log('[USDC] On-chain execution time:', usdcData.onChainTime, 'seconds');
            if (usdcData.explorer) {
              console.log('[USDC] Updating link with explorer:', usdcData.explorer);
              const descElem = $('#send-usdc-desc');
              if (descElem) {
                const timeDisplay = usdcData.onChainTime ? `[${usdcData.onChainTime} sec]` : '';
                descElem.innerHTML = `Spend executed on Arc <a href="${usdcData.explorer}" target="_blank" style="color: var(--accent); text-decoration: underline; font-weight: 600;">(${usdcData.amount} USDC)</a> <span style="color: var(--muted);">${timeDisplay}</span>`;
                console.log('[USDC] Updated send-usdc-desc with hyperlinked amount and on-chain timing');
              }
            } else {
              console.warn('[USDC] No explorer field in response');
            }

            updateSecureItem(3, 'success');
            await new Promise(r => setTimeout(r, 200));

            // Show commitment details if present
            if (usdcData.commit) {
              showResult('commit', usdcData.commit);
              // Attestation link is already set from approval response
            }

            // Step 4: after_invoke_tool validation
            updateSecureItem(4, 'active');
            await new Promise(r => setTimeout(r, 300));
            updateSecureItem(4, 'success');

            showResult('payment', usdcData);

            $('#send-btn').disabled = true;
            $('#send-btn').textContent = '✓ Payment Complete';
            $('#send-btn').className = 'btn btn-success';
            $('#send-btn').style.fontSize = '18px';
            $('#send-btn').style.fontWeight = '600';
          } else {
            // Items 3 & 4: Payment not approved
            updateSecureItem(3, 'active');
            updateSecureItem(4, 'active');
            $('#send-btn').textContent = 'Commit + Spend (Not Approved)';
          }

        } catch (err) {
          console.error(err);
          alert('Error: ' + String(err));
        } finally {
          // Re-enable run button
          $('#flow-run-btn').disabled = false;
          $('#flow-run-btn').textContent = '▶ Initiate User Request';
        }
      });

      $('#payment-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        if (!approvalData || approvalData.decision !== 1) {
          alert('Please run approval workflow first!');
          return;
        }

        try {
          // Step 3: send_usdc execution
          updateSecureItem(3, 'active');
          await new Promise(r => setTimeout(r, 300));

          const resp = await fetch('http://localhost:8616/api/send-usdc', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              to: $('#to').value,
              amount: $('#send-amount').value
            })
          });

          const data = await resp.json();
          if (data.error) throw new Error(data.error);

          // Update USDC transaction description with hyperlinked amount
          console.log('[USDC] Response data:', data);
          if (data.explorer) {
            console.log('[USDC] Updating link with explorer:', data.explorer);
            const descElem = $('#send-usdc-desc');
            if (descElem) {
              descElem.innerHTML = `Commit anchored + spend executed on Arc <a href="${data.explorer}" target="_blank" style="color: var(--accent); text-decoration: underline; font-weight: 600;">(${data.amount} USDC)</a>`;
              console.log('[USDC] Updated send-usdc-desc with hyperlinked amount');
            }
          } else {
            console.warn('[USDC] No explorer field in response');
          }

          updateSecureItem(3, 'success');
          await new Promise(r => setTimeout(r, 200));

          // Step 4: after_invoke_tool validation
          updateSecureItem(4, 'active');
          await new Promise(r => setTimeout(r, 300));
          updateSecureItem(4, 'success');

          showResult('payment', {
            method: data.method,
            txHash: data.hash,
            explorer: data.explorer,
            amount: `${data.amount} USDC`,
            from: data.from,
            to: data.to
          });

        } catch (err) {
          console.error(err);
          alert('Error: ' + String(err));
        }
      });
    </script>
    <script src="/x402-ui-patch.js"></script>
  </body>
</html>
